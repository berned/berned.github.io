<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Xkeyscore | B3RN3D]]></title>
  <link href="http://www.b3rn3d.com/blog/categories/xkeyscore/atom.xml" rel="self"/>
  <link href="http://www.b3rn3d.com/"/>
  <updated>2016-04-20T14:57:13+00:00</updated>
  <id>http://www.b3rn3d.com/</id>
  <author>
    <name><![CDATA[b3rn3d]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[XKeyScore Source Code Review]]></title>
    <link href="http://www.b3rn3d.com/blog/2014/07/04/xkeyscore-source-code-review/"/>
    <updated>2014-07-04T00:00:00+00:00</updated>
    <id>http://www.b3rn3d.com/blog/2014/07/04/xkeyscore-source-code-review</id>
    <content type="html"><![CDATA[<p>The <a href="http://boingboing.net/2014/07/03/if-you-read-boing-boing-the-n.html">recent revelations from Jake Applebaum, et all today</a>, highlight some not-to-be-understated revelations.</p>

<ul>
<li>Tor users are directly targeted</li>
<li>TAILS users are directly targeted</li>
<li>People searching for privacy tools are targeted</li>
</ul>


<p>While the conclusion by some may have been &ldquo;well of course the NSA is doing that&rdquo; the revelation and the insight it provides is direct, specific evidence that people worried about their privacy are being attacked. More-over, this provides further evidence that the NSA&rsquo;s goal is to <a href="http://www.democracynow.org/2014/5/13/collect_it_all_glenn_greenwald_on">collect it all</a>.</p>

<h2>The Revelations</h2>

<p>{% pullquote %}
To summarize, the source code to the NSA program, <a href="https://en.wikipedia.org/wiki/XKeyscore">XKeyscore</a> (known since the early days of the Snowden disclosures) has been leaked. It sounds like the program&rsquo;s entire source code is in the hands of another party and it shows what the code does, how it works and who it&rsquo;s targeting. We now know that {&ldquo;privacy-conscious bystanders are targeted: Tor users, people that visit the Tor website, people that use TAILS, or try to view hidden services &rdquo;}. Each of these are considered suspicious activities and flagged as the IP&rsquo;s of suspects by NSA&rsquo;s network monitoring machine.  This is further a reminder that if you look like you are privacy conscious, you are going to be a targeted as an &ldquo;extremist&rdquo; in the eyes of the United States and it&rsquo;s allies.
{% endpullquote %}</p>

<h2>Tracking Bridge Users</h2>

<p>XKeyscore is tracking the IP addresses that are sending emails to the Tor bridge automated account. When a user is in a country that blocks Tor, they have an option to use an unlisted Tor entry node called bridges. To get an unlisted bridge IP, one of the options is to email a Tor Project email address which auto-replies with an address of a bridge. The <a href="https://en.wikipedia.org/wiki/Five_Eyes">Five Eyes</a> have been documenting each IP that makes a request to that email address.</p>

<h2>Tracking Tor Directory Authorities</h2>

<p>Another facet disclosed was that the NSA are targeting a specific Tor directory server run by Sebastian Hahn. I believe that this is the case only because the source of the XKeycode leak was by a node in Germany. Looking at nodes in other countries, would point to a corresponding directory authority in that region.</p>

<p>Until relatively recently, the Tor Network consisted of only 9 directory servers of which all clients would first make a connection to prior to joining the Tor network. These 9 directory servers are still in place, but an additional feature lets Tor nodes act as a directory server cache. With this feature, you weren&rsquo;t automatically required to connect to one of the directory authorities during each bootup. This helps mitigate this risk.</p>

<h2>Tracking Tor Entry Nodes</h2>

<p>Even if your connection to the directory authorities were not caught by the program, your connections to the Tor entry nodes were. So while directory authorities were only used during boot, the connections to Tor entry nodes were used repeatedly as your client will build a circuit.</p>

<p>There&rsquo;s not much you can do to defend against this one. Using a bridge would ensure that XKeyScore won&rsquo;t know which IP&rsquo;s to track, but the requests for bridges are caught as well. One may consider running their own unlisted Tor entry node, which is possible, but it severely degrades your anonymity. Users concerned with this may consider using a VPN service and then connecting over Tor. This would not fix it, but it would make it more difficult to identify the originating request to connect to Tor.</p>

<h2>Tracking Torproject.org Visits</h2>

<p>One of the more useless network iterations that are logged is that of users visiting www.torproject.org. The document shows what they are calling &ldquo;microplugins&rdquo; that highlight specific pieces of information that are caught in transit. Your visit to the Tor Project&rsquo;s website logged and you are now flagged as suspicious.</p>

<h2>XKeyScore Code</h2>

<p>The most interesting part is the code released showing how XKeyScore works. Many have already highlighted that the NSA programs are merely malicious implementations of existing technology (as opposed to custom software built from the ground up). We can see that XKeyScore&rsquo;s database uses a <a href="https://en.wikipedia.org/wiki/Mapreduce">MapReduce</a> model. One very common with NoSQL databases like Hadoop. This is hinted in the &ldquo;mapper&rdquo; and &ldquo;reducer&rdquo; functions that searches for onion addresses:</p>

<p>{% codeblock %}
 mapper<onion_t>:
      static const std::string prefix = &ldquo;anonymizer/tor/hiddenservice/address/&rdquo;;</p>

<pre><code>  onion_t onion;
  size_t matches = cur_args()-&gt;matches.size();
  for (size_t pos=0; pos &lt; matches; ++pos) \{
    const std::string &amp;value = match(pos);
    if (value.size() == 16)
      onion.set_address(value);
    else if(!onion.has_scheme())
      onion.set_scheme(value);
    else
      onion.set_port(value);
  \}

  if (!onion.has_address())
    return false;

  MAPPER.map(onion.address(), onion);
  xks::fire_fingerprint(prefix + onion.address());
  return true;

reducer&lt;onion_t&gt;:
  for (values_t::const_iterator iter = VALUES.begin();
      iter != VALUES.end();
      ++iter) {
    DB["tor_onion_survey"]["onion_address"] = iter-&gt;address() + ".onion";
    if (iter-&gt;has_scheme())
      DB["tor_onion_survey"]["onion_scheme"] = iter-&gt;scheme();
    if (iter-&gt;has_port())
      DB["tor_onion_survey"]["onion_port"] = iter-&gt;port();
    DB["tor_onion_survey"]["onion_count"] = boost::lexical_cast&lt;std::string&gt;(TOTAL_VALUE_COUNT);
    DB.apply();
    DB.clear();
  }
  return true;
</code></pre>

<p>{% endcodeblock %}</p>

<h2>Full Code</h2>

<p>Below is the full code released:
<a href="/assets/xkeyscorerules100.txt">xkeyscorerules100.txt</a></p>
]]></content>
  </entry>
  
</feed>
